<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <meta http-equiv="content-type" content="text/html; charset=UTF-8;charset=utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="shortcut icon" href="http://codeshard.github.io/favicon.ico" />
        <title>DataTables and Django: Finally with Ajax!</title>
</head>

<body class="post-template">
<header class="post-header">
    <a class="blog-logo" href="http://codeshard.github.io">
        <span class="blog-title">CodeShard</span>
    </a>
</header>    <main id="content" class="content" role="main">
<article class="post">
    <span class="post-meta">
        <time datetime="Mon 21 July 2014">Mon 21 July 2014</time>
        in <a href="http://codeshard.github.io/category/articles.html/">articles</a>
            with tags:
                <a href="http://codeshard.github.io/tag/articles.html/">articles</a>
                <a href="http://codeshard.github.io/tag/django.html/">django</a>
                <a href="http://codeshard.github.io/tag/datatables.html/">datatables</a>
                <a href="http://codeshard.github.io/tag/ajax.html/">ajax</a>
    </span>
    <h1 class="post-title">
        <a href="http://codeshard.github.io/datatables-and-django-finally-with-ajax.html" rel="bookmark" title="Permalink to DataTables and Django: Finally with Ajax!">DataTables and Django: Finally with Ajax!</a>
    </h1>
    <section class="post-content"><p><a class="reference external" href="https://djangoproject.com">Django</a> and <a class="reference external" href="http://www.datatables.net/">DataTables</a> with Ajax: my nemesis during the last week. But after several attempts and burned my eyes in <a class="reference external" href="http://stackoverflow.com/">StackOverflow</a> and Django <a class="reference external" href="http://django.readthedocs.org/en/latest/releases/1.7.html">Documentation</a> I finally reach the solution. How I solved it? Just reading carefully the json outputted and the <a class="reference external" href="http://www.datatables.net/new/1.10">changelog</a> of DataTables 1.10 and how them now process the json and ajax requests. If you are reading this, perhaps you don't have any idea how Django or DataTables works, but over the Internet are a lot of great tutorials, so, I wont explain how work with them.
Let's begin. You should have a model defined, something like:</p>
<p><em>models.py</em></p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">someAttr</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">someAttr</span>
</pre></div>
<p>Then, you should define a view, returning a queryset in json format.</p>
<p><em>views.py</em></p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">MyModel</span>

<span class="k">def</span> <span class="nf">myModel_asJson</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">object_list</span> <span class="o">=</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="c">#or any kind of queryset</span>
    <span class="n">json</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="s">&#39;json&#39;</span><span class="p">,</span> <span class="n">object_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s">&#39;application/json&#39;</span><span class="p">)</span>
</pre></div>
<p>Here, you must define a url for your ajax view, as follows:</p>
<p><em>urls.py</em></p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">url</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;myapp.views&#39;</span><span class="p">,</span>
                    <span class="n">url</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span>
                    <span class="n">view</span><span class="o">=</span><span class="s">&#39;myModel_asJson&#39;</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="s">&#39;my_ajax_url&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
<p>Then in your template, you should define a table and the javascript function, something like:</p>
<p><em>template.html</em></p>
<div class="highlight"><pre><span class="nt">&lt;table</span> <span class="na">cellpadding=</span><span class="s">&quot;0&quot;</span> <span class="na">cellspacing=</span><span class="s">&quot;0&quot;</span> <span class="na">border=</span><span class="s">&quot;0&quot;</span> <span class="na">id=</span><span class="s">&quot;example&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;thead&gt;</span>
         <span class="nt">&lt;tr&gt;&lt;th&gt;</span>My Attr Heading<span class="nt">&lt;/th&gt;&lt;/tr&gt;</span>
     <span class="nt">&lt;/thead&gt;</span>
     <span class="nt">&lt;tbody&gt;&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>


<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">language=</span><span class="s">&quot;javascript&quot;</span> <span class="na">class=</span><span class="s">&quot;init&quot;</span><span class="nt">&gt;</span>
     <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
         <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#example&#39;</span><span class="p">).</span><span class="nx">dataTable</span><span class="p">(</span> <span class="p">{</span>
             <span class="s2">&quot;processing&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
             <span class="s2">&quot;ajax&quot;</span><span class="o">:</span> <span class="p">{</span>
                 <span class="s2">&quot;processing&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                 <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;{% url &#39;my_ajax_url&#39; %}&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;dataSrc&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span>
             <span class="p">},</span>

             <span class="s2">&quot;columns&quot;</span><span class="o">:</span> <span class="p">[</span>
                     <span class="p">{</span> <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="s2">&quot;fields.someAttr },</span>
<span class="s2">                     { &quot;</span><span class="nx">data</span><span class="s2">&quot;: &quot;</span><span class="nx">pk</span><span class="err">&quot;</span> <span class="p">}</span>
                 <span class="p">]</span>
         <span class="p">}</span> <span class="p">);</span>
     <span class="p">}</span> <span class="p">);</span>
 <span class="nt">&lt;/script&gt;</span>
</pre></div>
<p>Notice that <em>dataSrc</em> is empty due to the format of the json outputted by Django.You should also read how serialize natural keys in Django, in case you have foreign keys in your models. It is simple, but the documentation explain it very clearly:
Just add a method to the model itself:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">natural_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">my_natural_key</span>
</pre></div>
<p>This way you assure your json follows the foreing keys values and not the foreign key itself(which means the integer value).</p>
<p>And you got it! Or I hope so. The example above works for me, I wish it be self-explanatory, at least, more than other examples over the Internet.</p>
</section>
    <footer class="post-footer">
<section class="share">
    <h2>Share</h2>
    <a class="icon-twitter" href="https://twitter.com/share?text=DataTables and Django: Finally with Ajax!&amp;url=http://codeshard.github.io/datatables-and-django-finally-with-ajax.html"
        onclick="window.open(this.href, 'twitter-share', 'width=550,height=235'); return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="http://www.facebook.com/sharer/sharer.php?u=http://codeshard.github.io/datatables-and-django-finally-with-ajax.html"
        onclick="window.open(this.href, 'facebook-share', 'width=580,height=296'); return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://codeshard.github.io/datatables-and-django-finally-with-ajax.html"
        onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>    <section>
        <h2>Discuss</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          var disqus_shortname = 'codeshard';
          var disqus_identifier = '/datatables-and-django-finally-with-ajax.html';
          var disqus_url = 'http://codeshard.github.io/datatables-and-django-finally-with-ajax.html';
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
    </section>
    <footer>
</article>
    </main>
    <footer class="site-footer">
        <div class="inner">
            <section class="copyright">Copyright CodeShard.</section>
            <section class="poweredby">Powered by the <a href="https://kura.io/ghastly/">Ghastly</a> theme.</section>
        </div>
    </footer>
    <style type="text/css">
        @import url('http://codeshard.github.io/theme/css/ghastly.css?a39f6172');
    </style>
</body>
</html>